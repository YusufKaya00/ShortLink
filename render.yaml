services:
  # User Service
  - type: web
    name: user-service
    runtime: docker
    dockerfilePath: ./user-service/Dockerfile
    dockerContext: ./user-service
    envVars:
      - key: PORT
        value: 8081
      - key: DATABASE_URL
        fromDatabase:
          name: shortlink-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
    healthCheckPath: /health

  # URL Service
  - type: web
    name: url-service
    runtime: docker
    dockerfilePath: ./url-service/Dockerfile
    dockerContext: ./url-service
    envVars:
      - key: PORT
        value: 8082
      - key: DATABASE_URL
        fromDatabase:
          name: shortlink-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: shortlink-redis
          type: redis
          property: connectionString
      - key: USER_SERVICE_URL
        fromService:
          name: user-service
          type: web
          property: hostport
    healthCheckPath: /health

  # Stats Service
  - type: web
    name: stats-service
    runtime: docker
    dockerfilePath: ./stats-service/Dockerfile
    dockerContext: ./stats-service
    envVars:
      - key: PORT
        value: 8083
      - key: DATABASE_URL
        fromDatabase:
          name: shortlink-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: shortlink-redis
          type: redis
          property: connectionString
    healthCheckPath: /health

  # Frontend
  - type: web
    name: frontend
    runtime: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend

  # Redis
  - type: redis
    name: shortlink-redis
    plan: free
    maxmemoryPolicy: allkeys-lru

databases:
  - name: shortlink-db
    plan: free
